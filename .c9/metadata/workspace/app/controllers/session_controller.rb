{"changed":true,"filter":false,"title":"session_controller.rb","tooltip":"/app/controllers/session_controller.rb","value":"class SessionController < ApplicationController\n    \n    before_action :check_cred, except: :destroy\n    \n    def check_cred\n        if current_user\n            redirect_to root_path\n        end\n    end\n    def new\n        \n        \n    end\n    \n    def create\n        #create a new session \n        @user=User.find_by_handle(reference_params[:handle])\n        if @user && @user.encrypted_password==BCrypt::Engine.hash_secret(reference_params[:password], @user.salt)\n            session[:user_id]=@user.id\n            reference_params[:remember_me] ? session[:timeout]=DateTime.now + 30.days : session[:timeout]=DateTime.now + 30.minutes\n        else\n            flash[:error]='Incorect username or password'\n        end\n        \n        redirect_to root_path\n    end\n    \n    def destroy\n        reset_session\n        redirect_to root_path\n    end\n    def forgot_password\n        \n    end\n    def reset_password\n        user=User.find_by_email(reset_params)\n        if user\n            password=Faker::Internet.password(8)\n            user.password=password\n            user.save!\n            flash[:notice]='We have sent you an email with instructions to reset your password'\n            UserMailer.reset_email(reset_params, user, password).deliver_now\n            redirect_to :back\n        else\n            flash[:error]='Sorry no user with such email was found'\n            redirect_to :back\n        end\n    end\n    private\n        # Never trust parameters from the scary internet, only allow the white list through.\n        def reference_params\n          params.require(:user).permit(:handle, :password, :remember_me)\n        end\n        \n        def reset_params\n            params.require(:email)\n        end\nend\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1493724930790}